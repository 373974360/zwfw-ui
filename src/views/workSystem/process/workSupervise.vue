<template>
    <div class="app-container calendar-list-container">
        <div class="filter-container">
            <el-select
                    remote
                    style="width: 200px;" class="filter-item" placeholder="企业名称"
                    v-model="listQuery.companyId"
                    filterable clearable
                    :remote-method="queryCompanySearch"
                    @change="handleCompanySelect">
                <el-option
                        v-for="companyInfo in companyList"
                        :key="companyInfo.id"
                        :label="companyInfo.companyName"
                        :value="companyInfo.id">
                </el-option>
            </el-select>
            <el-date-picker class="filter-item"
                    v-model="dataChange"
                    type="daterange"
                    align="right"
                    placeholder="选择日期范围"
                    :picker-options="pickerOptions2" @change="formatStartDate">
            </el-date-picker>

            <el-button class="filter-item" type="primary" v-waves icon="search" @click="getList">搜索</el-button>
            <el-button  class="filter-item" type="primary" icon="document" @click="handleDownload">
                导出excel
            </el-button>
        </div>

        <el-table ref="zwfwDeptWorkPendingTable" :data="list" v-loading.body="listLoading" border fit
                  highlight-current-row
                  style="width: 100%" @selection-change="handleSelectionChange" @row-click="toggleSelection">
            <el-table-column align="center" label="办件序号">
                <template slot-scope="scope">
                    <span>{{scope.row.id}}</span>
                </template>
            </el-table-column>
            <el-table-column align="center" label="办理事项" width="200px">
                <template slot-scope="scope">
                    <span>{{scope.row.itemName}}</span>
                </template>
            </el-table-column>
            <el-table-column align="center" label="开始时间" prop="startItemTime">
                <template slot-scope="scope">
                    <span>{{scope.row.startItemTime | date('YYYY-MM-DD HH:mm:ss')}}</span>
                </template>
            </el-table-column>
            <el-table-column align="center" label="承诺办结时间" prop="promiseFinishTime">
                <template slot-scope="scope">
                    <span>{{scope.row.promiseFinishTime | date('YYYY-MM-DD HH:mm:ss')}}</span>
                </template>
            </el-table-column>
            <el-table-column align="center" label="实际用时" prop="promiseFinishTime">
                <template slot-scope="scope">
                    <span>{{scope.row.durationWorkSeconds | duration}}</span>
                </template>
            </el-table-column>
            <el-table-column align="center" label="超期件" prop="flagTimeout">
                <template slot-scope="scope">
                    <span>{{scope.row.flagTimeout | enums('YesNo')}}</span>
                </template>
            </el-table-column>
            <el-table-column align="center" label="督办件" prop="flagSupervied">
                <template slot-scope="scope">
                    <span>{{scope.row.flagSupervied | enums('YesNo')}}</span>
                </template>
            </el-table-column>
            <el-table-column align="center" label="资料存档状态" prop="flagArchive">
                <template slot-scope="scope">
                    <span>{{scope.row.flagArchive | enums('YesNo')}}</span>
                </template>
            </el-table-column>
            <el-table-column align="left" label="申请企业（个人）" min-width="200">
                <template slot-scope="scope">
                    <span v-if="scope.row.memberType == 1">
                        姓名：{{scope.row.memberRealname}}<br>联系电话：{{scope.row.memberPhonenumber}}<br>
                    </span>
                    <span v-if="scope.row.memberType == 2 || scope.row.memberType == 3">
                        <span v-if="scope.row.companyName">
                            公司：{{scope.row.companyName}}<br>
                        </span>
                        法人姓名：{{scope.row.memberRealname}}<br>联系电话：{{scope.row.memberPhonenumber}}<br>
                    </span>
                </template>
            </el-table-column>
            <el-table-column align="left" label="办事员信息" min-width="200">
                <template slot-scope="scope">
                    <span v-if="scope.row.memberType == 3">
                        <span>
                            姓名：{{scope.row.clerkName}}<br>
                        </span>联系电话：{{scope.row.clerkPhone}}<br>
                    </span>
                    <span v-if="scope.row.memberType == 1 || scope.row.memberType == 2">
                        <span>
                            姓名：{{scope.row.memberRealname}}<br>
                        </span>联系电话：{{scope.row.memberPhonenumber}}<br>
                    </span>
                </template>
            </el-table-column>
            <!--<el-table-column align="center" label="企业名称" prop="companyName">-->
            <!--<template slot-scope="scope">-->
            <!--<span>{{scope.row.companyName}}</span>-->
            <!--</template>-->
            <!--</el-table-column>-->
            <el-table-column prop="enable" class-name="status-col" label="状态">
                <template slot-scope="scope">
                    <span>{{scope.row.status | enums('ItemProcessStatus')}}</span>
                </template>
            </el-table-column>
            <el-table-column align="center" label="操作" width="200px">
                <template slot-scope="scope">
                    <el-button type="primary" @click="handleDetailList(scope.row)">查看
                    </el-button>
                    <el-button v-show="scope.row.flagSupervied != null && scope.row.flagSupervied == 0"
                               class="filter-item"
                               type="primary"
                               @click="setSupervised(scope.row)">标记督办
                    </el-button>
                    <el-button v-show="scope.row.flagSupervied != null && scope.row.flagSupervied == 1"
                               class="filter-item"
                               type="primary"
                               @click="cancelSupervised(scope.row)">取消督办
                    </el-button>
                </template>
            </el-table-column>
        </el-table>

        <div v-show="!listLoading" class="pagination-container">
            <el-pagination @size-change="handleSizeChange" @current-change="handleCurrentChange"
                           :current-page.sync="listQuery.page" :page-sizes="this.$store.state.app.pageSize"
                           :page-size="listQuery.rows" layout="total, sizes, prev, pager, next, jumper" :total="total">
            </el-pagination>
        </div>

        <el-dialog size="large" class="s-dialog-title" :title="textMapTitle" :close-on-click-modal="closeOnClickModal"
                   :visible.sync="dialogFormVisible" :before-close="resetDeptSuperviseForm">
            <div>
                <div>
                    <h3 class="h2-style-show">企业（个人）信息：</h3>
                    <div>
                        <div v-if="member.legalPerson!=null">
                            <table class="table table-responsive table-bordered">
                                <tr>
                                    <th width="140">办事企业/机构</th>
                                    <td>{{member.legalPerson.companyName}}</td>
                                    <th width="140">统一社会信用代码</th>
                                    <td>{{member.legalPerson.companyCode}}</td>
                                </tr>
                                <tr>
                                    <th width="140">法人姓名</th>
                                    <td>{{member.legalPerson.legalPerson}}</td>
                                    <th width="140">法人身份证号</th>
                                    <td>{{member.legalPerson.idcard}}</td>
                                </tr>
                                <tr>
                                    <th width="140">企业/机构地址</th>
                                    <td>{{member.legalPerson.registerPlace}}</td>
                                    <th width="140">联系电话</th>
                                    <td>{{member.legalPerson.phone}}</td>
                                </tr>
                                <tr>
                                    <th width="140">办事员电话</th>
                                    <td>{{itemProcessVo.contactsPhone}}</td>
                                    <th width="140"></th>
                                    <td></td>
                                </tr>
                                <template v-if="companyInfo.id">
                                    <tr>
                                        <th width="140">联系电话</th>
                                        <td>{{companyInfo.lxdh}}</td>
                                        <th width="140">企业类型</th>
                                        <td>{{companyInfo.qllx}}</td>
                                    </tr>
                                    <tr>
                                        <th width="140">注册资金</th>
                                        <td>{{companyInfo.zczj}}</td>
                                        <th width="140">成立日期</th>
                                        <td>{{companyInfo.clrq}}</td>
                                    </tr>
                                    <tr>
                                        <th width="140">营业期限</th>
                                        <td colspan="3">{{companyInfo.yyqx}}</td>
                                    </tr>
                                    <tr>
                                        <th width="140">经营范围</th>
                                        <td colspan="3">{{companyInfo.jyfw}}</td>
                                    </tr>
                                    <tr>
                                        <th width="140">状态</th>
                                        <td>{{companyInfo.djzt}}</td>
                                        <th width="140">所属街道</th>
                                        <td>{{companyInfo.ssjd}}</td>
                                    </tr>
                                </template>
                            </table>
                        </div>
                        <div v-if="member.naturePerson!=null && member.type == 3">
                            <h3>授权办事员信息：</h3>
                        </div>
                        <div v-if="member.naturePerson!=null">
                            <table class="table table-responsive table-bordered">
                                <tr>
                                    <th width="140">姓名</th>
                                    <td>{{member.naturePerson.name}}</td>
                                    <th width="140">身份证号</th>
                                    <td>{{member.naturePerson.idcard}}</td>
                                </tr>
                                <tr>
                                    <th width="140">邮箱</th>
                                    <td>{{member.email}}</td>
                                    <th width="140">手机</th>
                                    <td>{{member.naturePerson.phone}}</td>
                                </tr>
                                <tr>
                                    <th width="140">地址</th>
                                    <td colspan="3">{{member.naturePerson.address}}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <div>
                    <h3 class="h2-style-show">办件进度：</h3>
                    <table class="table table-bordered table-responsive">
                        <tr v-if="itemProcessVo.limitTime">
                            <td>当前步骤期限</td>
                            <td>
                                {{itemProcessVo.limitTime | date('YYYY-MM-DD HH:mm:ss')}}
                                <!--包括工作日{{itemProcessVo.limitTime|fromNow}}-->
                            </td>
                        </tr>
                        <tr>
                            <td>当前办理步骤</td>
                            <td>{{itemProcessVo.currentTaskName}}</td>
                        </tr>
                        <tr>
                            <td>督办件</td>
                            <td>{{itemProcessVo.flagSupervied | enums('YesNo')}}</td>
                        </tr>
                        <tr>
                            <td>超期件</td>
                            <td>{{itemProcessVo.flagTimeout | enums('YesNo')}}</td>
                        </tr>
                        <tr>
                            <td>整改状态</td>
                            <td>{{itemProcessVo.flagCorrection | enums('YesNo')}}</td>
                        </tr>
                        <tr>
                            <td>申请办件时间</td>
                            <td>{{itemProcessVo.startItemTime | date('YYYY-MM-DD HH:mm:ss')}}</td>
                        </tr>
                        <tr>
                            <td>承诺办结日期</td>
                            <td>{{itemProcessVo.promiseFinishTime | date('YYYY-MM-DD HH:mm:ss')}}
                            </td>
                        </tr>
                        <tr>
                            <td>流入当前步骤时间</td>
                            <td>{{itemProcessVo.taskCreateTime | date('YYYY-MM-DD HH:mm:ss')}}</td>
                        </tr>
                    </table>
                </div>
                <div>
                    <h3 class="h2-style-show">审批记录：</h3>
                    <table class="table table-responsive table-bordered">
                        <tr>
                            <td>流入时间</td>
                            <td>办理步骤</td>
                            <td>信息</td>
                            <td>办理时间</td>
                            <td>耗时</td>
                            <td>办理人</td>
                        </tr>
                        <tr v-for="h in history">
                            <td>{{h.createTime | date('YYYY-MM-DD HH:mm')}}</td>
                            <td>{{h.name}}</td>
                            <td>
                                <table v-if="h.formValue!=null" class="table table-bordered">
                                    <tr v-for="(v,k) in h.formValue">
                                        <th>{{k}}:</th>
                                        <td>{{v}}</td>
                                    </tr>
                                </table>
                            </td>
                            <td>
                                <template v-if="h.endTime">{{h.endTime | date('YYYY-MM-DD HH:mm')}}
                                </template>
                            </td>
                            <td>
                                <template v-if="h.durationInMillis">{{h.durationInMillis | duration}}
                                </template>
                            </td>
                            <td>
                                <template v-if="h.assignee">{{users[h.assignee]}}</template>
                            </td>
                        </tr>
                    </table>
                </div>
                <div>
                    <h3 class="h2-style-show">整改记录：</h3>
                    <table class="table table-responsive table-bordered">
                        <tr>
                            <td>整改时间</td>
                            <td>所在步骤</td>
                            <td>整改原因</td>
                            <td>操作人</td>
                        </tr>
                        <tr v-for="h in correctionList">
                            <td>{{h.correctionTime | date('YYYY-MM-DD HH:mm')}}</td>
                            <td>{{h.taskName}}</td>
                            <td>{{h.correctionReason}}</td>
                            <td>{{h.correctionUserName}}</td>
                        </tr>
                    </table>
                </div>
                <div>
                    <h3 class="h2-style-show">延期记录：</h3>
                    <table class="table table-responsive table-bordered">
                        <tr>
                            <td>申请时间</td>
                            <td>延期天数</td>
                            <td>延期到</td>
                            <td>所在步骤</td>
                            <td>延期原因</td>
                            <td>审核状态</td>
                            <td>申请人</td>
                            <td>审核人</td>
                        </tr>
                        <tr v-for="h in extendTimeVoList">
                            <td>{{h.timeExtendApply | date('YYYY-MM-DD HH:mm')}}</td>
                            <td>{{h.timeExtendWorkdates}}</td>
                            <td>{{h.timeExtendToDate | date('YYYY-MM-DD HH:mm')}}</td>
                            <td>{{h.taskName}}</td>
                            <td>{{h.reason}}</td>
                            <td>{{h.timeExtendStatus | enums('TimeExtendStatus')}}</td>
                            <td>{{h.applyUserName}}</td>
                            <td>{{h.auditUserName}}</td>
                        </tr>
                    </table>
                </div>
                <div>
                    <el-tabs v-model="tabPaneShow" type="card">
                        <el-tab-pane label="办理事项" name="first">
                            <table class="table table-bordered table-responsive">
                                <tr>
                                    <td>办理事项</td>
                                    <td>{{itemVo.name}}</td>
                                </tr>
                                <tr>
                                    <td>办理主体</td>
                                    <td>{{itemVo.departmentName}}</td>
                                </tr>
                                <tr>
                                    <td>事项审批涉及的部门</td>
                                    <td>{{itemVo.departmentNames}}</td>
                                </tr>
                                <tr>
                                    <td>办件类型</td>
                                    <td>{{itemVo.type | enums('ItemType')}}</td>
                                </tr>
                                <tr>
                                    <td>承诺时限</td>
                                    <td>{{itemVo.promiseDay}} 天</td>
                                </tr>
                                <tr>
                                    <td>法定时限</td>
                                    <td>{{itemVo.legalDay}} 天</td>
                                </tr>
                                <tr>
                                    <td>核准数量</td>
                                    <td>{{itemVo.authorizedQuantity == 0
                                        ? '无限' : itemVo.authorizedQuantity}}
                                    </td>
                                </tr>
                                <tr>
                                    <td>收费情况</td>
                                    <td>{{itemVo.chargeStandard}}</td>
                                </tr>
                                <tr>
                                    <td>收费依据</td>
                                    <td>{{itemVo.chargeBasis}}</td>
                                </tr>
                                <tr>
                                    <td>批准证件</td>
                                    <td>{{itemVo.approvalDocumentName}}</td>
                                </tr>
                                <tr>
                                    <td>联系电话</td>
                                    <td>{{itemVo.tellphone}}</td>
                                </tr>
                                <tr>
                                    <td>监督电话</td>
                                    <td>{{itemVo.superviseTellphone}}</td>
                                </tr>
                            </table>

                            <div v-if="itemVo.commonRequestion!=null && itemVo.commonRequestion!=''">
                                <h3>注意事项:</h3>
                                <pre class="panel-warning">{{itemVo.commonRequestion}}</pre>
                            </div>
                        </el-tab-pane>
                        <el-tab-pane label="法定依据" name="second">
                            <span>{{itemVo.setBasis}}</span>
                        </el-tab-pane>
                        <el-tab-pane label="办理条件" name="third">
                            <span v-for="c in itemConditionVoList">
                                {{c.content}}
                            </span>
                        </el-tab-pane>
                        <el-tab-pane label="办件材料" name="fifth">
                            <el-button @click="downloadMaterialFiles()" type="primary">一键下载材料</el-button>
                            <br><br>
                            <table class="table table-bordered table-responsive">
                                <tr>
                                    <th>序号</th>
                                    <th>材料</th>
                                    <th width="50">查看</th>
                                </tr>
                                <tr v-for="c in itemMaterialVoList">
                                    <td>{{c.id}}</td>
                                    <td>{{c.name}}</td>
                                    <td>
                                        <div v-if="c.multipleFile" style="color:blue">
                                            <span v-for="(file,index) in c.multipleFile">
                                            <span v-if="file.url!=null && file.url!=''">
                                                <a v-if="file.fileType=='zzk'"
                                                   :href="'/api/zwfw-web/member/zzk/view?licenseNo='+file.url"
                                                   target="_blank" :title="file.fileName">[{{index + 1}}]</a>
                                                <a v-else-if="!/\.(gif|jpg|jpeg|png|GIF|JPG|PNG)$/.test(file.url)"
                                                   :href="file.url" :download="file.fileName"
                                                   target="_blank">[{{index + 1}}]</a>
                                                <a v-else :href="file.url" target="_blank" :title="file.fileName">[{{index + 1}}]</a>
                                            </span>
                                            <span v-else>未上传</span>
                                         </span>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </el-tab-pane>
                        <el-tab-pane label="表单信息" name="pretrialForm">
                            <div v-if="pretrialForm && pretrialForm.length>0">
                                <h2 class="h2-style-show">预审表单：</h2>
                                <div v-for="form in pretrialForm">
                                    <table class="table table-responsive table-bordered">
                                        <tr>
                                            <th colspan="24" style="text-align: center;background: #eee;">
                                                {{form.title}}
                                            </th>
                                        </tr>
                                        <tr v-for="row in form.rows">
                                            <td v-for="(field,index) in row"
                                                :colspan="field.size"
                                                :key="field.id"
                                                style="padding:5px;">
                                    <span class="label"><span v-if="field.require" style="color:red">*</span>
                                        {{field.labelAlias || field.label}}:</span> <span
                                                    class="value">{{field.value}}</span>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                            <div v-else>无</div>
                        </el-tab-pane>
                    </el-tabs>
                </div>
            </div>
        </el-dialog>

    </div>
</template>

<script>
    import {validateQueryStr} from 'utils';
    import {mapGetters} from 'vuex';
    import {
        getDeptSuperviseList, getDeptWorkDetail, workCancelSupervised, workSetSupervised,getProcessDetailInfo
    } from '../../../api/zwfwSystem/business/deptSupervise';
    import {
        getAllCompany
    } from 'api/other/company';
    import {date, enums, dics, duration} from '../../../filters'
    import {
        queryCompanyInfo
    } from 'api/hallSystem/window/receive/windowAccept';
    import moment from 'moment';

    export default {
        name: 'zwfwDeptWorkPending_table',
        data() {
            return {
                pickerOptions2: {
                    shortcuts: [{
                        text: '最近一周',
                        onClick(picker) {
                            const end = new Date();
                            const start = new Date();
                            start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);
                            picker.$emit('pick', [start, end]);
                        }
                    }, {
                        text: '最近一个月',
                        onClick(picker) {
                            const end = new Date();
                            const start = new Date();
                            start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);
                            picker.$emit('pick', [start, end]);
                        }
                    }, {
                        text: '最近三个月',
                        onClick(picker) {
                            const end = new Date();
                            const start = new Date();
                            start.setTime(start.getTime() - 3600 * 1000 * 24 * 90);
                            picker.$emit('pick', [start, end]);
                        }
                    }]
                },
                dataChange: [],
                textMapTitle: null,
                itemNumber: [],
                list: null,
                total: null,
                listLoading: true,
                companyList: [],
                listQuery: {
                    page: this.$store.state.app.page,
                    rows: this.$store.state.app.rows,
                    name: undefined,
                    companyId: undefined,
                    startDate: undefined,
                    endData: undefined
                },
                exportQuery:{
                    startDate: undefined,
                    endData: undefined
                },
                exportList: null,
                itemMaterialVoList: [],
                itemProcessVo: [],
                correctionList: [],
                member: [],
                history: [],
                extendTimeVoList: [],
                itemConditionVoList: [],
                itemVo: [],
                taskFormValue: {},
                users: {},
                selectedRows: [],
                currentRow: null,
                dialogFormVisible: false,
                dialogStatus: '',
                dialogLoading: false,
                tabPaneShow: 'first',
                companyInfo: {
                    id: '',
                    node_id: '',
                    ty_code: '',
                    zz_code: '',
                    gs_code: '',
                    qymc: '',
                    fr: '',
                    lxr: '',
                    lxdh: '',
                    qllx: '',
                    jgzs: '',
                    zczj: '',
                    clrq: '',
                    yyqx: '',
                    jyfw: '',
                    djjg: '',
                    hzrq: '',
                    djzt: '',
                    bak: '',
                    add_type: '',
                    add_time: '',
                    add_user: '',
                    up_time: '',
                    up_user: '',
                    ssjd: '',
                    vtype: ''
                },
                pretrialForm: []
            }
        },
        created() {
            this.getList();
        },
        computed: {
            ...mapGetters([
                'textMap',
                'enums',
                'closeOnClickModal'
            ])
        },
        methods: {
            formatStartDate() {
                if (this.dataChange[0] == null) {
                    this.listQuery.startDate = undefined;
                    this.listQuery.endDate = undefined;
                    this.exportQuery.startDate = undefined;
                    this.exportQuery.endDate = undefined;
                } else {
                    this.listQuery.startDate = moment(this.dataChange[0]).format("YYYY-MM-DD");
                    this.listQuery.endDate = moment(this.dataChange[1]).format("YYYY-MM-DD");
                    this.exportQuery.startDate = moment(this.dataChange[0]).format("YYYY-MM-DD");
                    this.exportQuery.endDate = moment(this.dataChange[1]).format("YYYY-MM-DD");
                }
                console.log(this.dataChange);
            },
            handleDownload() {
                getProcessDetailInfo(this.exportQuery).then(response => {
                    this.exportList = response.data;
                    require.ensure([], () => {
                        const {export_json_to_excel} = require('vendor/Export2Excel');
                        const tHeader = ['序号', '事项', '受理时间', '办结时间', '实际使用时间', '是否超期', '是否最多跑一次', '办件类型', '受理窗口', '审批部门', '备注'];
                        const filterVal = ['id', 'itemName', 'startItemTime','finishItemTime', 'durationWorkSeconds', 'flagSupervied', 'flagOnce', 'itemProcessType', 'windowName', 'departmentName', 'status'];
                        const exportList = this.exportList;
                        const data = this.formatJson(filterVal, exportList);
                        export_json_to_excel(tHeader, data, '办件明细表');
                    })
                })
            },
            formatJson(filterVal, jsonData) {
                return jsonData.map(function (v,index) {
                    return filterVal.map(function (j) {
                        console.log(index);
                        if (j === 'id') {
                            return index+1;
                        }else if(j === 'durationWorkSeconds'){
                            return duration(v[j]);
                        }else if(j === 'durationWorkSeconds'){
                            return duration(v[j]);
                        }else if(j === 'itemProcessType'){
                            return dics(v[j],'bjlx')
                        }else if(j === 'flagSupervied'){
                            if (v[j] == 1) {
                                return '是'
                            }else {
                                return '否'
                            }
                        }else if(j === 'flagOnce'){
                            if (v[j] == 1) {
                                return '是'
                            }else {
                                return '否'
                            }
                        } else {
                            return v[j]
                        }
                    });
                });
            },
            getList() {
                this.listLoading = true;
                getDeptSuperviseList(this.listQuery).then(response => {
                    this.list = response.data.list;
                    this.total = response.data.total;
                    this.listLoading = false;
                })
            },
            handleSizeChange(val) {
                this.listQuery.rows = val;
                this.listQuery.name = null;
                this.getList();
            },
            handleCurrentChange(val) {
                this.listQuery.page = val;
                this.getList();
            },
            handleSelectionChange(rows) {
                this.selectedRows = rows;
            },
            toggleSelection(row) {
                this.$refs.zwfwDeptWorkPendingTable.toggleRowSelection(row);
            },
            handleDetailList(row) {
                this.processNumber = row.processNumber;
                this.taskId = row.taskId;
                this.textMapTitle = '部门办事 - ' + row.itemName;
                this.dialogFormVisible = true;
                const query = {
                    processNumber: this.processNumber,
                    taskId: this.taskId
                }
                getDeptWorkDetail(query).then(response => {
                    console.log(response.data);
                    this.itemConditionVoList = response.data.itemConditionVoList;
                    this.itemMaterialVoList = response.data.itemMaterialVoList;
                    this.itemProcessVo = response.data.itemProcessVo;
                    this.taskForm = response.data.taskForm;
                    this.itemVo = response.data.itemVo;
                    this.member = response.data.member;
                    this.history = response.data.history;
                    this.users = response.data.users;
                    this.correctionList = response.data.correctionList;
                    this.extendTimeVoList = response.data.extendTimeVoList;
                    this.queryCompanyInfo(this.member);
                    this.pretrialForm = [];
                    for (const form of data.pretrialForm || []) {
                        for (const field of form.fields) {
                            field.value = data.pretrialFormFieldValueMap[field.fieldId] || '';
                        }
                        const fields = form.fields;
                        const rowsData = [];
                        let pos = 0;
                        let rows = 0;
                        fields.forEach(field => {
                            if (24 - pos < field.size) {
                                rows++;
                                pos = 0;
                            }
                            pos += field.size;
                            if (!rowsData[rows]) {
                                rowsData[rows] = [];
                            }
                            rowsData[rows].push(field);
                        });
                        form.rows = rowsData;
                        this.pretrialForm.push(form);
                    }
                });
            },
            /**
             * 查询企业信息
             */
            queryCompanyInfo(memberInfo) {
                this.companyInfo = {};
                if (memberInfo.memberCode == '' || memberInfo.memberCode.length != 18) {
                    this.companyInfo = {};
                    return;
                }
                queryCompanyInfo({
                    memberCode: memberInfo.memberCode
                }).then(response => {
                    if (response.httpCode === 200) {
                        let c = response.data;
                        if (c) {
                            this.companyInfo = c;
                        }
                    } else {
                        this.companyInfo = {};
                    }
                })
            },
            setSupervised(id) {
                workSetSupervised(id).then(response => {
                    console.log(response.data);
                    this.getList();
                })
            },
            cancelSupervised(id) {
                workCancelSupervised(id).then(response => {
                    console.log(response.data);
                    this.getList();
                })
            },
            queryCompanySearch(queryString) {
                let valid = validateQueryStr(queryString);
                if (valid) {
                    this.$message.error(`输入中包含非法字符 ${valid}`)
                    return
                }
                if (queryString.length < 2) {
                    return;
                }
                // 调用 callback 返回建议列表的数据
                const query = {
                    companyName: queryString
                };
                getAllCompany(query).then(response => {
                    if (response.httpCode === 200) {
                        this.companyList = response.data;
                    } else {
                        this.$message.error('查询失败');
                    }
                });
            },
            handleCompanySelect(code) {
                this.listQuery.companyId = code;
                this.getList();
            },
            resetTemp() {
                this.itemNumber = {
                    id: undefined,
                    itemName: '',
                    startItemTime: '',
                    promiseFinishTime: '',
                    flagTimeout: '',
                    flagSupervied: '',
                    flagArchive: '',
                    memberRealname: '',
                    companyName: '',
                    status: '',
                    enable: 1
                };
            },
            resetDeptSuperviseForm() {
                this.dialogFormVisible = false;
                this.tabPaneShow = 'first';
            },
            downloadMaterialFiles() {
                // console.log(this.itemProcessVo);
                window.open('/api/common/downloadMaterialFiles?processNumber=' + this.itemProcessVo.processNumber + '&taskId=' + this.itemProcessVo.taskId);
            }
        }
    }
</script>
<style>
    .table-bordered {
        border: 1px solid #EBEBEB;
    }

    .table-responsive {
        min-height: .01%;
        overflow-x: auto;
    }

    .table {
        width: 100%;
        max-width: 100%;
        margin-bottom: 20px;
        background-color: transparent;
        border-spacing: 0;
        border-collapse: collapse;
    }

    .table > tr > td, .table > tr > th {
        border-top: 1px solid #e7eaec;
        line-height: 1.42857;
        padding: 8px;
        vertical-align: middle;
    }

    .table-bordered > tr > td, .table-bordered > tr > th {
        border: 1px solid #e7e7e7;
    }

    .h2-style-show {
        font-weight: 400;
        font-size: 24px;
    }

    #itemStepInfo table {
        width: 100%;
        margin-top: 20px;
    }

    #itemStepInfo table th, #itemInfo table td {
        height: 30px;
        line-height: 30px;
        border: 1px solid #bfcbd9;
        padding: 6px;
    }

    #itemStepInfo table th {
        text-align: left;
        background-color: #eef1f6;

    }

    .s-dialog-title .el-form-item__label {
        font-size: 24px;
    }

    .s-dialog-title label {
        font-weight: 100;
    }

    .s-dialog-title .el-dialog__title {
        font-size: 17px;
        font-weight: 500;
    }

    .s-dialog-title .input-textarea .el-textarea__inner {
        height: 10em;
    }
</style>
